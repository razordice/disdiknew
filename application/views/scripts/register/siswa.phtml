<?php
$model = new Application_Model_RegisterModel();
$kecamatan = $model->loadKecamatan();
?>
<link rel="stylesheet" href="<?php echo $this->baseUrl();?>/datepicker-custom/css/base/jquery-ui-1.9.2.custom.css"/><!-- bootstrap grid -->
<script src="<?php echo $this->baseUrl();?>/datepicker-custom/js/jquery-ui-1.9.2.custom.js"></script>
<div class="page-title-style01 pt-bkg11">
  <div class="container">
      <div class="row">
        <div class="col-md-10">
          <div class="breadcrumb-container">
            <ul class="breadcrumb">
              <li>You are here:</li>
              <li>
                <a href="<?php echo $this->baseUrl() ?>/index">Home</a>
              </li>
              <li>
                <a href="<?php echo $this->baseUrl() ?>/login">Login</a>
              </li>
              <li>
                Pendaftaran Siswa
              </li>
            </ul><!-- .breadcrumb end -->
          </div><!-- .breadcrumb-container end -->
        </div>
      </div>
  </div>
</div>
<div class="page-content">
  <div class="container">
    <div class="custom-heading">
        <h2>Pendaftaran Siswa</h2>
        <?php
            if($this->message != '') {
              echo $this->message;
            }
        ?>
    </div><!-- .custom-heading end -->
    <form class="login-form wpcf7" action="" method="post">
      <div class="row">
        <div class="col-md-6 custom-bkg bkg-dark-blue dark">
          <h3>Register I (Data Sekolah)</h3>
          <fieldset>
            <label for="nis">NIS <span class="required">*</span></label>
            <input type="text" name="nis" id="nis" value="" class="input-text wpcf7-text" required="required">
          </fieldset>
          <fieldset>
            <label for="kec">Kecamatan <span class="required">*</span></label>
            <select name="kec" class="input-text wpcf7-select kecamatan" required="required">
              <option value="">-- Pilih Kecamatan --</option>
              <?php foreach ($kecamatan as $kec) {?>
              <option value="<?php echo $kec['id_kec'];?>">
                <?php echo $kec['nama_kec'];?>
              </option>
              <?php } ?>
            </select>
          </fieldset>
          <fieldset>
            <label for="tingkat_sekolah">Tingkat Sekolah <span class="required">*</span></label>
            <select name="tingkat_sekolah" class="input-text wpcf7-select" id="tingkat_sekolah" required="required">
              <option value="">-- Pilih Tingkat Sekolah --</option>
              <!-- <option value="TK">TK</option> -->
              <option value="SD">SD</option>
              <option value="SMP">SMP</option>
              <option value="SMA">SMA</option>
              <option value="SMK">SMK</option>
            </select>
          </fieldset>
          <fieldset>
            <label for="nama_sekolah">Nama Sekolah <span class="required">*</span></label>
            <select name="nama_sekolah" class="input-text wpcf7-select" id="nama_sekolah" required="required">
              <option value="">-- Pilih Tingkat Sekolah Dahulu--</option>
            </select>
          </fieldset>
          <fieldset>
            <label for="status">Status Sekolah <span class="required">*</span></label>
            <select name="status" class="input-text wpcf7-select" id="status" required="required">
              <option value="">-- Pilih --</option>
              <option value="1">Negeri</option>
              <option value="2">Swasta</option>
            </select>
          </fieldset>
          <fieldset>
            <label for="alamat_sekolah">Alamat Sekolah<span class="required">*</span></label>
            <textarea name="alamat_sekolah" rows="8" cols="40" class="input-text wpcf7-textarea" id="alamat_sekolah" required="required"></textarea>
          </fieldset>
        </div>
        <div class="col-md-6 custom-bkg bkg-dark-blue dark">
          <h3>Register II (Data Siswa)</h3>
          <fieldset>
            <label for="nama">Nama Lengkap <span class="required">*</span></label>
            <input type="text" name="nama" id="nama" value="" class="input-text wpcf7-text" required="required">
          </fieldset>
          <fieldset>
            <div class="form-wide" style="margin-right:10px;">
              <label for="tl">Tempat Lahir<span class="required">*</span></label>
              <input type="text" name="tl" id="tl" value="" class="input-text wpcf7-text" required="required">
            </div>
            <div class="form-wide" style="margin-right:10px;">
              <label for="tgllahir">Tanggal Lahir<span class="required">*</span></label>
              <input type="text" name="tgllahir" id="tgllahir" value="" class="input-text wpcf7-text" required="required">
            </div>
          </fieldset>
          <fieldset>
            <label for="jkelamin">Jenis Kelamin <span class="required">*</span></label>
            <select name="jkelamin" class="input-text wpcf7-select" id="jkelamin" required="required">
              <option value="">-- Pilih --</option>
              <option value="L">Laki-laki</option>
              <option value="P">Perempuan</option>
             </select>
          </fieldset>
          <fieldset>
            <label for="agama">Agama <span class="required">*</span></label>
            <select name="agama" class="input-text wpcf7-select" id="agama" required="required">
              <option value="">-- Pilih --</option>
              <option value="islam">Islam</option>
              <option value="katholik">Kristen Katholik</option>
              <option value="protestan">Kristen Protestan</option>
              <option value="hindu">Hindu</option>
              <option value="budha">Budha</option>
              <option value="konghucu">Konghucu</option>
             </select>
          </fieldset>
          <fieldset>
            <label for="tlp">No Telepon/Handphone <span class="required">*</span></label>
            <input type="text" name="tlp" id="tlp" value="" class="input-text wpcf7-text" required="required">
          </fieldset>
          <fieldset>
            <label for="alamat">Alamat Rumah<span class="required">*</span></label>
            <textarea name="alamat" rows="8" cols="40" class="input-text wpcf7-textarea" required="required"></textarea>
          </fieldset>
          <fieldset>
            <label for="email">Email <span class="required">*</span></label>
            <input type="text" name="email" id="email" value="" class="input-text wpcf7-text" required="required">
            <div class="alert-email"></div>
          </fieldset>
          <fieldset>
            <label for="password">Password <span class="required">*</span></label>
            <input type="password" name="password" id="password" value="" class="input-text wpcf7-text" required="required">
          </fieldset>
          <fieldset>
            <label for="confirm">Confrim Password <span class="required">*</span></label>
            <input type="password" name="confirm" id="confirm" value="" class="input-text wpcf7-text">
            <div class="alert-con-pass" required="required"></div>
          </fieldset>
          <!-- <fieldset>
            <label for="foto">Upload Foto <span class="required">*</span></label>
            <input type="file" name="foto" id="foto" class="input-text">
          </fieldset> -->
          <fieldset>
            <div class="required">
              * Wajib Di isi!
            </div>
          </fieldset>
          <div class="alert alert-info">
            Harap mengecek kembali data yang di masukkan sebelum daftar!
          </div>
          <input type="submit" class="wpcf7-submit" value="Daftar" />
        </div>


        </div>
      </div>
    </form>
  </div>
</div>
<script type="text/javascript">
  $(document).ready(function() {
    $('#tgllahir').datepicker({
      changeYear: true,
      changeMonth:true,
      dateFormat: 'yy-mm-dd',
      yearRange : "-70:+0"
    });
    function isEmail(email) {
      var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
      return regex.test(email);
    }

    $('#tlp').bind('keypress', function (e) {
        return (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57) && e.which != 46) ? false : true;
    });

    $('#email').focusout(function() {
      var value = $(this).val();
      var base_url = "<?php echo $this->baseUrl() ?>";
      if(!isEmail(value)){
        $(".alert-email").text("Email tidak valid!");
        $(".alert-email").show();
      } else {
        $(".alert-email").text("");
        $(".alert-email").hide();
        $.ajax({
            type: "POST",
            data: {
                'email' : value,
                'akses' : 'siswa',
            },
            url: base_url+"/register/cekallemail",
            beforeSend: function(){
              $(".alert-email").text("Cek Ketersedian Email..");
            },
            success: function(data){
              if(data.data !="") {
                $(".alert-email").text(data.data);
                $(".alert-email").show();
              } else {
                $(".alert-email").hide();
              }
            }
        });
      }
    });

    $('#confirm').focusout(function () {
      var c = $(this).val();
      var p = $("#password").val();
      if(c!=p) {
        $(".alert-con-pass").text("Password tidak sama!");
        $(".alert-con-pass").show();
      } else {
        $(".alert-con-pass").hide();
        $(".alert-con-pass").text("");
      }
    });

    $('.kecamatan, #tingkat_sekolah').change(function() {
      var tingkat = $('#tingkat_sekolah').val();
      var kec = $('.kecamatan').val();
      var base_url = "<?php echo $this->baseUrl() ?>";
      if(tingkat != 0 && kec != 0) {
        $.ajax({
            type: "POST",
            data: {
                'id_kec' : kec,
                'tingkat' : tingkat,
            },
            url: base_url+"/register/ajaxsekolah",
            beforeSend: function(){
              $('#nama_sekolah').html("<option>Harap Tunggu...</option>");
            },
            success: function(data){
              var sekolah = '<option value="">-- Pilih Sekolah --</option>';
              for(j=0; j < data.data.length;j++){
                 sekolah+='<option value='+data.data[j]['induk_sekolah']+'>'+data.data[j]['nama_sekolah']+'</option>';
               }
               $('#nama_sekolah').html(sekolah);

             }
        });
      }
    });
  });
</script>
